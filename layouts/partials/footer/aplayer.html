<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<div id="aplayer"></div>

<script>
    // Hugo 中的音乐根目录（关键修复点）
    const musicDir = '{{ "music/" | relURL }}';
    const songs = [
        '削いで、-r906',
        '조깅-LUCY',
        'もうじき夏が終わるから-nbuna',
        'Love is lonely-NMIXX',
        'フィクションブルー-Ayase',
        'Endless-onewe',
        'tat-hitorie',
        'Doughnut-Twice',
        'Ditto-Newjeans',
        'Rooftop-Nflying'
    ];

    let audios = [];
    songs.forEach(item => {
        const songInfo = item.split('-');
        audios.push({
            name: songInfo[0],
            artist: songInfo[1],
            url: musicDir + encodeURIComponent(item) + '/song.mp3',
            cover: musicDir + encodeURIComponent(item) + '/cover.png',
        });
    });

    const ap = new APlayer({
        container: document.getElementById('aplayer'),
		fixed: true,
        audio: audios
    });
</script>

<script>
	    /**
	     * 页面销毁前监听
	     */
	    window.onbeforeunload = () => {
	        // 将播放信息用对象封装，并存入到localStorage中
	        const playInfo = {
	            index: ap.list.index,
	            currentTime: ap.audio.currentTime,
	            paused: ap.paused
	        };
	        localStorage.setItem("playInfo", JSON.stringify(playInfo));
	    };
	
	    /**
	     * 页面加载后监听
	     */
	    window.onload = () => {
	        // 从localStorage取出播放信息
	        const playInfo = JSON.parse(localStorage.getItem("playInfo"));
	        if (!playInfo) {
	            return;
	        }
	        // 切换歌曲
	        ap.list.switch(playInfo.index);
	        // 等待500ms再执行下一步(切换歌曲需要点时间，不能立马调歌曲进度条)
	        setTimeout(() => {
	            // 调整时长
	            ap.seek(playInfo.currentTime);
	            // 是否播放
	            if (!playInfo.paused) {
	                ap.play()
	            }
	        }, 500);
	    };

</script>